<% layout("/layouts/boilerplate.ejs") %>

<style>
  .show-container {
    max-width: 1100px;
    margin: auto;
  }

  .title-card {
    border: none;
    border-radius: 1rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    padding: 1.2rem 1rem;
  }

  .title-card h4 {
    margin: 0;
    font-weight: 600;
  }

  .image-card {
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
  }

  .show-img {
    height: 24rem;
    object-fit: cover;
  }

  .details-card {
    border: none;
    padding: 1.25rem 0;
  }

  .details-card p {
    font-size: 0.95rem;
    line-height: 1.7;
    color: #444;
  }

  .price {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2c7be5;
  }

  .location {
    color: #6c757d;
  }

  .show-btns {
    display: flex;
    gap: 0.75rem;
  }

  .review-card {
  border: none;
  border-radius: 1rem;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  height: 100%;
  padding: 1rem;
}
.review-card .card-body {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.review-comment {
  flex-grow: 1;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
}
.review-actions {
  margin-top: auto;
}
  .review-card p {
    margin-bottom: 0.4rem;
  }

  .review-form textarea {
    resize: none;
  }
</style>

<div class="show-container mt-4">
  <div class="card title-card col-8 offset-2 mb-3">
    <h4><%= showlisting.title %></h4>
  </div>

  <div class="col-8 offset-2 image-card mb-3">
    <img
      class="card-img-top show-img"
      src="<%= showlisting.image.url %>"
      alt="Listing Image"
    />
  </div>

  <div class="col-8 offset-2">
    <div class="details-card">
      <p>
        <b>Owner:</b> <%= showlisting.owner.username %><br />
        <%= showlisting.description %><br />
        <span class="price">â‚¹<%= showlisting.price %></span><br />
        <span class="location">
          <%= showlisting.location %>, <%= showlisting.country %>
        </span>
      </p>
    </div>
  </div>

  <div class="map col-8 offset-2 mb-4"></div>

  <% if (currUser && showlisting.owner._id.equals(currUser._id)) { %>
    <div class="show-btns col-8 offset-2 mt-2">
      <a href="/listings/<%= showlisting._id %>/edit" class="btn btn-outline-dark">
        Edit
      </a>
      <form
        method="post"
        action="/listings/<%= showlisting._id %>?_method=DELETE"
      >
        <button class="btn btn-danger">Delete</button>
      </form>
    </div>
    <hr class="col-8 offset-2" />
  <% } %>

  <div class="col-8 offset-2">
    <% if (currUser) { %>
      <h5 class="mb-2">Leave a review</h5>
      <form
        action="/listings/<%= showlisting._id %>/reviews"
        method="POST"
        class="needs-validation review-form"
        novalidate
      >
        <fieldset class="starability-slot mb-2">
          <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked />
          <input type="radio" id="first-rate1" name="review[rating]" value="1" />
          <label for="first-rate1">1 star</label>
          <input type="radio" id="first-rate2" name="review[rating]" value="2" />
          <label for="first-rate2">2 stars</label>
          <input type="radio" id="first-rate3" name="review[rating]" value="3" />
          <label for="first-rate3">3 stars</label>
          <input type="radio" id="first-rate4" name="review[rating]" value="4" />
          <label for="first-rate4">4 stars</label>
          <input type="radio" id="first-rate5" name="review[rating]" value="5" />
          <label for="first-rate5">5 stars</label>
        </fieldset>

        <textarea
          name="review[comment]"
          class="form-control mb-2"
          rows="4"
          placeholder="Share your experience"
          required
        ></textarea>

        <button class="btn btn-dark mb-3">Submit Review</button>
      </form>
    <% } %>

    <hr />

   <div class="row">
  <% for (review of showlisting.reviews) { %>
    <div class="col-md-6 d-flex">
      <div class="card review-card mb-3 w-100">
        <div class="card-body">
          <p><b><%= review.author.username %></b></p>

          <p
            class="starability-result"
            data-rating="<%= review.rating %>"
          ></p>

          <p class="review-comment"><%= review.comment %></p>

          <% if (currUser && review.author._id.equals(currUser._id)) { %>
            <div class="review-actions">
              <form
                method="POST"
                action="/listings/<%= showlisting._id %>/reviews/<%= review._id %>?_method=DELETE"
              >
                <button class="btn btn-sm btn-outline-danger">
                  Delete
                </button>
              </form>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  <% } %>
</div>

  </div>
</div>
